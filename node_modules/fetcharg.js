const sdk = require('node-appwrite');
const fs = require("fs");
const {render} = require("mustache");

// Init SDK
let client = new sdk.Client();

let database = new sdk.Database(client);

client
    .setEndpoint('APPWRITE_ENDPOINT') // Your API Endpoint
    .setProject('APPWRITE_PROJECTID') // Your project ID
    .setKey('APPWRITE_APIKEY') // Your secret API key
;

//let promise = database.getDocument('627e9b5e008ffd8382ff', '6283ccb7773a9474319d')
let promise = database.listDocuments('627e9b5e008ffd8382ff');

promise.then(function (response) {
    console.log(response);   

    const template = `
---
title: "{{title}}"  
date: {{date}} 
---
{{desc}}
`;


    for (let i=0;i<=response.documents.length-1;i++){
        const obj= response.documents[i];
        const tempObj ={
            title: obj.Title,
            date: new Date(),
            desc: obj.Body
          }
        
          const op = render(template, tempObj);
          const opPath = `./quickstart/content/posts/${obj.Title.split(" ").join("-")}.md`
          fs.writeFileSync(opPath, op)
    }

}, function (error) {
    console.log(error);
});


